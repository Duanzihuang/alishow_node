{{extend './layout.html'}}

{{block 'content'}}
<div class="container-fluid">
    <form class="row" id="form">
        <div class="col-md-9">
          <div class="form-group">
            <label for="title">标题</label>
            <input id="title" class="form-control input-lg" name="article_title" type="text" placeholder="文章标题">
          </div>
          <div class="form-group">
            <label for="content">内容</label>
            <textarea id="content" class="form-control input-lg" name="article_body" cols="30" rows="10" placeholder="内容"></textarea>
            <input type="file" id="upload_file" style="display: none;">
          </div>
        </div>
        <div class="col-md-3">
          <div class="form-group">
            <label for="slug">别名</label>
            <input id="slug" class="form-control" name="article_slug" type="text" placeholder="slug">
            <p class="help-block">https://example.com/post/<strong>slug</strong></p>
          </div>
          <div class="form-group">
            <label for="feature">特色图像</label>
            <!-- show when image chose -->
            <img class="help-block thumbnail" style="display: none">
            <input id="feature" class="form-control" name="article_file" type="file">
          </div>
          <div class="form-group">
            <label for="category">所属分类</label>
            <select id="category" class="form-control" name="article_cateid">
              <option value="1">潮科技</option>
            </select>
          </div>
          <div class="form-group">
            <label for="created">发布时间</label>
            <input id="created" class="form-control" name="article_pubtime" type="datetime-local">
          </div>
          <div class="form-group">
            <label for="status">状态</label>
            <select id="status" class="form-control" name="article_status">
              <option value="草稿">草稿</option>
              <option value="已发布">已发布</option>
            </select>
          </div>
          <div class="form-group">
            <button class="btn btn-primary" type="submit" id="submit_btn">保存</button>
          </div>
        </div>
      </form>
</div>
{{/block}}

{{block 'script'}}
  <script>
    $("#submit_btn").on('click',function(e){
      // 阻止默认行为
      e.preventDefault()

      var fd = new FormData(document.querySelector("form"))

      $.ajax({
        url: "/api/posts/create",
        type: "POST",
        data: fd,
        processData: false,  // 不处理数据
        contentType: false,   // 不设置内容类型
        success:function(result){
          if (result.success) {
            location.href = '/admin/posts'
          }
        }
      });
    })
  </script>
{{/block}}